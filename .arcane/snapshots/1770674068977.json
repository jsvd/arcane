{"error":"TypeError: mutations.map is not a function
    at transaction (file:///Users/arkham/project/arcane/runtime/state/transaction.ts:161:27)
    at handleAttack (file:///Users/arkham/project/escape-the-castle/game.ts:735:20)
    at handleCommand (file:///Users/arkham/project/escape-the-castle/game.ts:458:12)
    at handleInput (file:///Users/arkham/project/escape-the-castle/game.ts:1028:22)
    at file:///Users/arkham/project/escape-the-castle/game.ts:1056:3
    at <frame>:1:46","snapshot":{"state":{"player":{"currentRoom":"entrance_hall","health":100,"maxHealth":100,"gold":0,"inventory":[],"moves":0},"rooms":{"entrance_hall":{"name":"Entrance Hall","description":"A grand entrance hall with marble floors and towering columns that reach up to a vaulted ceiling. Torches flicker on the walls, casting dancing shadows across ancient tapestries depicting long-forgotten battles. The air is cold and musty.","briefDescription":"The grand entrance hall with marble columns.","visited":false,"exits":{"north":"library","east":"armory","south":"dungeon"},"items":[],"npcs":["guard"]},"armory":{"name":"Armory","description":"A room filled with weapon racks and armor stands, most of which are empty or hold rusted equipment beyond repair. Dust covers everything like a thick blanket. A few pieces of salvageable gear remain on a wooden table in the corner.","briefDescription":"The dusty armory with scattered weapons.","visited":false,"exits":{"west":"entrance_hall","north":"throne_room"},"items":["rusty_sword","wooden_shield"],"npcs":[],"locked":true},"library":{"name":"Library","description":"Towering bookshelves line the walls from floor to ceiling, filled with leather-bound tomes and ancient scrolls. A large wooden reading table sits in the center with a single book open on a pedestal. The smell of old paper and ink fills the air.","briefDescription":"The vast library with countless books.","visited":false,"exits":{"south":"entrance_hall","west":"kitchen","up":"tower"},"items":["ancient_book"],"npcs":["librarian"]},"kitchen":{"name":"Kitchen","description":"A large stone kitchen with a massive fireplace that once cooked feasts for hundreds. Iron pots hang from hooks above the cold hearth. A wooden cupboard stands against the far wall, its doors slightly ajar. Cobwebs drape from the ceiling beams.","briefDescription":"The abandoned kitchen with a large fireplace.","visited":false,"exits":{"east":"library"},"items":["health_potion"],"npcs":[]},"dungeon":{"name":"Dungeon","description":"A dark and damp prison with iron bars on small cells lining the walls. The air is thick with the smell of mildew and decay. Water drips somewhere in the darkness. Without light, you can barely see your hand in front of your face.","briefDescription":"The dark and foreboding dungeon.","visited":false,"exits":{"north":"entrance_hall"},"items":["gold_coins","torch"],"npcs":[],"dark":true},"tower":{"name":"Tower","description":"The top of a tall tower with narrow windows that offer a view of the surrounding countryside. A spiral staircase leads down. The room is circular with stone walls and a wooden floor. Dust motes dance in the beams of sunlight streaming through the windows.","briefDescription":"The top of the tower with a scenic view.","visited":false,"exits":{"down":"library"},"items":[],"npcs":[]},"throne_room":{"name":"Throne Room","description":"A magnificent hall with a raised platform at the far end where an ornate throne sits empty. Crimson banners hang from the walls, faded with age. The ceiling is painted with scenes of coronations and royal ceremonies. An aura of power lingers in the air.","briefDescription":"The majestic throne room with an empty throne.","visited":false,"exits":{"south":"armory"},"items":[],"npcs":[],"locked":true}},"items":{"rusty_sword":{"name":"Rusty Sword","description":"A worn blade that has seen better days","type":"weapon","weight":3,"location":"armory","visible":true,"properties":{"damage":15}},"wooden_shield":{"name":"Wooden Shield","description":"A sturdy oak shield with iron bands","type":"armor","weight":4,"location":"armory","visible":true,"properties":{"defense":10}},"health_potion":{"name":"Health Potion","description":"A red vial that glows faintly","type":"consumable","weight":1,"location":"kitchen","visible":true,"properties":{"healing":30}},"ancient_book":{"name":"Ancient Book","description":"Contains a cryptic riddle about the throne","type":"quest","weight":2,"location":"library","visible":true,"properties":{"text":"Only the worthy may sit, with sword and shield they must commit"}},"gold_coins":{"name":"Gold Coins","description":"A small pouch of gold coins","type":"treasure","weight":1,"location":"dungeon","visible":false,"properties":{"value":50}},"torch":{"name":"Torch","description":"A wooden torch wrapped in oil-soaked cloth","type":"light","weight":2,"location":"dungeon","visible":true,"properties":{}},"crown":{"name":"Crown","description":"A jeweled crown that sparkles in the light","type":"treasure","weight":2,"location":"tower","visible":false,"properties":{"value":100}},"magic_key":{"name":"Magic Key","description":"A golden key with strange runes","type":"key","weight":1,"location":"kitchen_cupboard","visible":false,"properties":{"unlocks":"throne_room"}}},"npcs":{"guard":{"name":"Guard","health":30,"maxHealth":30,"damage":10,"hostile":true,"alive":true,"dialogue":"Halt! None shall pass without proving their worth!"},"librarian":{"name":"Librarian","hostile":false,"alive":true,"dialogue":"Seek wisdom in the ancient texts, traveler. The book on the pedestal holds secrets."},"dragon":{"name":"Dragon","health":50,"maxHealth":50,"damage":25,"hostile":true,"alive":false,"dialogue":"You dare enter my domain unprepared? Perish!"}},"flags":{"torchLit":false,"guardDefeated":false,"dragonSpawned":false,"gameWon":false,"gameLost":false}},"timestamp":1770674068977}}